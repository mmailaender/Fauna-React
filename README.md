# Motivation

Fauna provides with FQL.X a typescipt like languange and offers build in typesafety with Schema enforcement (TODO: Link). This client streamlines the typesafe experience between Fauna and your React project by 
- syncing the types from Fauna to your Typescript project
- transform and compose your typessafe functions on the fly to FQL.X post Requests .

![image](https://github.com/mmailaender/Fauna-React/assets/87228994/5260ec7e-9ae5-453f-a996-9fdaaff70cdf)


# Getting Started
## Install

```bash
pnpm install github:mmailaender/Fauna-React
pnpm install ts-node
```

## Create schema 
1. Create `fqlx.schema.json` file on root level (same level like `package.json`)
2. And add your schema into the file:

Example schema
```json
{
  "Car": {
    "fields": {
      "plate": "string",
      "brand": "string",
      "owner": "Customer"
    }
  },
  "Customer": {
    "fields": {
      "name": "string",
      "cars": "[Cars]"
    }
  }
}
```

## Extend `package.json`

```
"scripts": {
    ...,
    "fqlx:generate": "ts-node node_modules/fqlx-client/src/converter.ts"
},
```

## Generate TS interfaces
```
pnpm fqlx:generate
```

You should see the following folder structure as output
```
|- fqlx-generated
| |- collectionsWithFields.ts
| |- typedefs.ts
```

## Configure Client

Wrap your App with the `<FqlxProvider>`

### Nextjs
```tsx
import { FqlxProvider } from 'fqlx-client';
import './globals.css';
import dynamic from 'next/dynamic';

export const metadata = {
  title: 'Create Next App',
  description: 'Generated by create next app',
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang='en'>
      <body>
        <FqlxProvider config={{ fqlxSecret: <userFaunaAccessToken> }} >
          {children}
        </FqlxProvider>
      </body>
    </html>
  );
}
```

### FqlxProvider

| Property   | Mandatory? | Description | Example |
|------------|------------|-----------------------------------------------------------------------------------------------------------------------------------|-------------------------|
| fqlxSecret | ‚úîÔ∏è         | The secret to authenticate with Fauna. Recommended to use an <br> accessToken from your users, that you received after user login | `fqlxSecret: useAuth()` |
| loader     | üóô          | You can provide a skeleton loader component that displays <br> automatically that component during suspense.                      | `loader: {<Skeleton />}` |
| endpoint   | üóô          | Specify the Fauna endpoint. Default is Fauna cloud `https://db.fauna.com`. If you're not a Fauna Beta tester, or using the Fauna Docker version you don't need this | `endpoint: new URL('https://db.fauna-preview.com')` |

## Use Client

```tsx
import { useQuery as query } from 'fqlx-client';

const OwnedCars = (customerId) => {
  return ({
    query.Customer.firstWhere((customer) => {customer.id == customerId}).cars.exec().map((car) => {
        return (
          <div>
            {car.plate}
          </div>
        )
      });
  });
}

export default OwnedCars;
```

### .exec() function
FQL.X is following the same syntax as Typescript. e.g. `.map()` can be executed on `Fauna` or on `Browser/Edge/Node` side.  That means, we need to tell the app which part of the code should run on `Fauna` side and which code should run on `Browser/Edge/Node` side. <br><br>
For that we use the
```js
.exec()
```
function. Put it at the end of your query, were you want to have a handover from `Fauna` to `Browser/Edge/Node` side. <br>
Everything **before** `.exec()` will run on `Fauna` side. Everything **after** `.exec()` will run on `Browser/Edge/Node` side.
